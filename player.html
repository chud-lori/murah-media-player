<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Murah Media Player</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1 class="header-title" id="headerTitle">Murah Media Player</h1>
            <div class="file-controls">
                <button id="alwaysOnTopBtn" class="control-btn" title="Always on Top (T)">
                    <i id="alwaysOnTopIcon" class="fas fa-thumbtack"></i>
                </button>
                <button id="videoInfoBtn" class="control-btn" title="Video Info (I)">
                    <i class="fas fa-info-circle"></i>
                </button>
                <button id="keyboardHelpBtn" class="control-btn" title="Keyboard Shortcuts (?)">
                    <i class="fas fa-question-circle"></i>
                </button>
                <div class="file-input-wrapper">
                    <input type="file" id="videoFile" accept="video/*, .mkv, video/x-matroska, video/matroska" />
                    <button id="videoFileBtn" class="file-btn">
                        <i class="fas fa-video"></i> Load Video
                    </button>
                </div>
                <div class="file-input-wrapper">
                    <input type="file" id="subtitleFile" accept=".srt, .vtt" />
                    <button id="subtitleFileBtn" class="file-btn">
                        <i class="fas fa-closed-captioning"></i> Load Subtitle
                    </button>
            </div>
            </div>
        </header>

        <!-- Video Section -->
        <section class="video-section">
            <div id="videoWrapper" class="video-wrapper">
            <video id="mediaPlayer" preload="auto"></video>
            <video id="previewVideo" style="display: none; position: absolute; width: 1px; height: 1px; opacity: 0; pointer-events: none;" preload="auto" muted playsinline></video>
                <div id="skipIndicator" class="skip-indicator">
                    <i class="skip-icon"></i>
                    <span class="skip-text"></span>
                </div>
                <div id="volumeIndicator" class="volume-indicator">
                    <i class="volume-indicator-icon"></i>
                    <span class="volume-indicator-text">100%</span>
                </div>
                <div id="loadingIndicator" class="loading-indicator hidden">
                    <div class="loading-spinner"></div>
                    <span class="loading-text">Loading...</span>
                </div>
                <div id="messageOverlay" class="message-overlay">
                Please load a video file to begin playback.
            </div>
        </div>
        </section>

        <!-- Controls Section -->
        <section class="controls-section">
            <!-- Seek Bar -->
            <div class="seek-container">
                <span id="currentTime" class="time-display">00:00</span>
                <div class="seek-bar-wrapper">
                    <input type="range" id="seekBar" value="0" min="0" max="0" />
                    <div id="seekBarTooltip" class="seek-bar-tooltip">00:00</div>
                    <div id="seekBarPreview" class="seek-bar-preview hidden">
                        <div class="seek-preview-thumbnail">
                            <canvas id="seekPreviewCanvas"></canvas>
                        </div>
                        <div class="seek-preview-time">00:00</div>
                    </div>
                </div>
                <span id="duration" class="time-display">00:00</span>
            </div>

            <!-- Control Buttons -->
            <div class="controls-row">
                <div class="controls-left">
                    <button id="prev5Btn" class="control-btn" title="Seek Backward 5s (Left Arrow)">
                        <i class="fas fa-backward"></i>
                    </button>
                    <button id="playPauseBtn" class="control-btn play-pause-btn" title="Play/Pause (Space)">
                        <i id="playPauseIcon" class="fas fa-play translate-x-[1px]"></i>
                    </button>
                    <button id="next5Btn" class="control-btn" title="Seek Forward 5s (Right Arrow)">
                        <i class="fas fa-forward"></i>
                    </button>
                </div>
                
                <div class="controls-right">
                    <div class="volume-control">
                        <button id="muteToggleBtn" class="control-btn" title="Mute (M)">
                        <i id="volumeIcon" class="fas fa-volume-up"></i>
                    </button>
                        <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="1" title="Volume" />
                    </div>
                    
                    <select id="speedSelect" class="speed-select" title="Playback Speed">
                            <option value="0.5">0.5x</option>
                            <option value="0.75">0.75x</option>
                            <option value="1.0" selected>1.0x</option>
                            <option value="1.25">1.25x</option>
                            <option value="1.5">1.5x</option>
                            <option value="2.0">2.0x</option>
                        </select>
                    
                    <button id="fullscreenToggleBtn" class="control-btn" title="Fullscreen (F)">
                        <i id="fullscreenIcon" class="fas fa-expand"></i>
                    </button>
                </div>
            </div>

            <!-- Subtitle Controls -->
            <div class="subtitle-controls">
                <span class="subtitle-controls-label">Subtitle Styling:</span>
                <div class="subtitle-options">
                    <div class="subtitle-option">
                        <label for="fontSizeInput">Size:</label>
                        <input type="number" id="fontSizeInput" min="0.5" max="3.0" step="0.1" value="1.8" />
                    </div>
                    <div class="subtitle-option">
                        <label for="colorInput">Color:</label>
                        <input type="color" id="colorInput" value="#FFFFFF" />
                    </div>
                </div>
            </div>
        </section>

        <!-- Video Info Panel -->
        <div id="videoInfoPanel" class="video-info-panel hidden">
            <div class="video-info-header">
                <h3>Video Information</h3>
                <button id="closeVideoInfoBtn" class="control-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="video-info-content" id="videoInfoContent">
                <p>No video loaded</p>
            </div>
        </div>

        <!-- Keyboard Shortcuts Help Overlay -->
        <div id="keyboardHelpOverlay" class="keyboard-help-overlay hidden">
            <div class="keyboard-help-content">
                <div class="keyboard-help-header">
                    <h2>Keyboard Shortcuts</h2>
                    <button id="closeKeyboardHelpBtn" class="control-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="keyboard-help-list" id="keyboardHelpList">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="scripts/main.js"></script>
    <script>
        // Add platform class to body for CSS targeting
        if (navigator.platform.toLowerCase().includes('mac') || 
            navigator.userAgent.toLowerCase().includes('mac')) {
            document.body.classList.add('platform-darwin');
        }
        
        // File input button triggers
        document.getElementById('videoFileBtn').addEventListener('click', () => {
            document.getElementById('videoFile').click();
        });

        document.getElementById('subtitleFileBtn').addEventListener('click', () => {
            document.getElementById('subtitleFile').click();
        });

        // Handle Electron menu actions if available
        if (window.electronAPI) {
            window.electronAPI.onFileSelected((filePath) => {
                // Handle file selection from menu
                // Note: In Electron, we'd need to use fs to read the file
                // For now, this is a placeholder
                console.log('File selected from menu:', filePath);
            });

            window.electronAPI.onSubtitleSelected((filePath) => {
                console.log('Subtitle selected from menu:', filePath);
            });

            window.electronAPI.onPlaybackToggle(() => {
                const playPauseBtn = document.getElementById('playPauseBtn');
                if (playPauseBtn) playPauseBtn.click();
            });

            window.electronAPI.onSeek((seconds) => {
                if (window.videoPlayer) {
                    window.videoPlayer.seek(seconds);
                }
            });

            window.electronAPI.onToggleVideoInfo(() => {
                // Trigger video info panel toggle
                if (window.controlsHandler) {
                    window.controlsHandler.toggleVideoInfoPanel();
                } else {
                    // Fallback: find the button and click it
                    const videoInfoBtn = document.getElementById('videoInfoBtn');
                    if (videoInfoBtn) videoInfoBtn.click();
                }
            });
        }
    </script>
</body>
</html>
